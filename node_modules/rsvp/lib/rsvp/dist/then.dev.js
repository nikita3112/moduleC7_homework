"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = then;

var _config = require("./config");

var _instrument = _interopRequireDefault(require("./instrument"));

var _internal = require("./-internal");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function then(onFulfillment, onRejection, label) {
  var parent = this;
  var state = parent._state;

  if (state === _internal.FULFILLED && !onFulfillment || state === _internal.REJECTED && !onRejection) {
    _config.config.instrument && (0, _instrument["default"])('chained', parent, parent);
    return parent;
  }

  parent._onError = null;
  var child = new parent.constructor(_internal.noop, label);
  var result = parent._result;
  _config.config.instrument && (0, _instrument["default"])('chained', parent, child);

  if (state === _internal.PENDING) {
    (0, _internal.subscribe)(parent, child, onFulfillment, onRejection);
  } else {
    var callback = state === _internal.FULFILLED ? onFulfillment : onRejection;

    _config.config.async(function () {
      return (0, _internal.invokeCallback)(state, child, callback, result);
    });
  }

  return child;
}