'use strict';

var path = require('path');

var resolveCwd = require('resolve-cwd');

var pkgDir = require('pkg-dir');

module.exports = function (filename) {
  var globalDir = pkgDir.sync(path.dirname(filename));
  var relativePath = path.relative(globalDir, filename);

  var pkg = require(path.join(globalDir, 'package.json'));

  var localFile = resolveCwd.silent(path.join(pkg.name, relativePath));
  var localNodeModules = path.join(process.cwd(), 'node_modules');
  var filenameInLocalNodeModules = !path.relative(localNodeModules, filename).startsWith('..'); // Use `path.relative()` to detect local package installation,
  // because __filename's case is inconsistent on Windows
  // Can use `===` when targeting Node.js 8
  // See https://github.com/nodejs/node/issues/6624

  return !filenameInLocalNodeModules && localFile && path.relative(localFile, filename) !== '' && require(localFile);
};